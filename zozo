import logging
from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup
from telegram.ext import (
    Application,
    CommandHandler,
    MessageHandler,
    CallbackQueryHandler,
    ContextTypes,
    filters,
)

TOKEN = "8530765022:AAGVhutqpcgyX9tfp9MtME9rqZZLr7N_pdo"

WELCOME_TEXT = """Ù‡Ø°Ù‡ Ø§Ù„Ø¨ÙˆØª Ù…Ø®ØªØµ Ø¨Ù€ Ø§Ø®ØªØ±Ø§Ù‚ Ø­Ø³Ø§Ø¨Ø§Øª 
Ø§Ù„Ø§Ù†Ø³ØªÚ¯Ø±Ø§Ù… Ø³Ø­Ù€Ø¨ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù€Ù…Ø¹Ù„ÙˆÙ…Ø§Øª. """

NO_PERMISSION_TEXT = """Ù„Ø§ØªØ´Ø§Ø±Ùƒ Ù‡Ø§Ø°Ù‡ Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ Ù…Ø¹ Ø§Ø­Ø¯ ğŸª„. 

Ø¨Ø§Ø³ÙˆØ±Ø¯ Ø§Ù„Ø­Ø³Ø§Ø¨: zaidd67i
"""
logging.basicConfig(level=logging.INFO)

# --------- Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ---------
async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    keyboard = [[InlineKeyboardButton("ÙŠÙˆØ²Ø± Ø§Ù„Ø¶Ø­ÙŠÙ‡ ğŸŒ‹.", callback_data="insta_username")]]
    await update.message.reply_text(
        WELCOME_TEXT, reply_markup=InlineKeyboardMarkup(keyboard)
    )

# --------- Ø·Ù„Ø¨ Ø§Ù„ÙŠÙˆØ²Ø± ---------
async def ask_username(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()
    context.user_data["awaiting_username"] = True
    await query.message.reply_text("Ù‚Ù… Ø¨Ø§Ø±Ø³Ø§Ù„ ÙŠÙˆØ²Ø± Ø§Ù„Ø¶Ø­ÙŠÙ€Ù‡ ğŸ—¿.")

# --------- Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„ÙŠÙˆØ²Ø± ---------
async def receive_username(update: Update, context: ContextTypes.DEFAULT_TYPE):
    if not context.user_data.get("awaiting_username"):
        return

    context.user_data["awaiting_username"] = False
    username = update.message.text.strip().lower().replace("@", "")

    if username == "u2u.y":
        text = """ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø¶Ø­ÙŠÙ‡ ğŸ˜†ğŸ”¥. 

Ø§Ø³Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ : Ø²ÙŠÙ€ÙˆÙØ¯ÙŠ
Ø¹Ø¯Ø¯ Ø§Ù„Ù…ØªØ§Ø¨Ø¹ÙŠÙ† : 2198
Ø¹Ø¯Ø¯ Ø§Ù„Ø§ØªØ§Ø¨Ø¹Ù‡ : 5
Ø§Ù„Ø¨Ø§ÙŠÙˆ : Ù„Ø§ÙŠÙˆØ¬Ø¯
"""

        keyboard = [
            [
                InlineKeyboardButton("ÙƒØ´Ù Ø§Ù„Ø¨Ø±ÙŠØ¯ ğŸªª.", callback_data="no_perm"),
                InlineKeyboardButton("Ø§Ø¶Ù€Ù‡Ø§Ø± Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ ğŸ§±.", callback_data="no_perm"),
            ],
            [
                InlineKeyboardButton("ÙƒØ´Ù Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª ğŸ“².", callback_data="no_perm"),
                InlineKeyboardButton("ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨ â›½ï¸.", callback_data="no_perm"),
            ],
            [InlineKeyboardButton("Ø³Ø­Ø¨ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ â›©.", callback_data="logout")],
        ]

        await update.message.reply_text(
            text, reply_markup=InlineKeyboardMarkup(keyboard)
        )
    else:
        await update.message.reply_text("âŒ Ù‡Ø°Ø§ Ø§Ù„Ø¨ÙˆØª ÙŠØ¯Ø¹Ù… Ø­Ø§Ù„ÙŠØ§Ù‹ Ø­Ø³Ø§Ø¨ ÙˆØ§Ø­Ø¯ ÙÙ‚Ø· Ù„Ù„ØªØ¬Ø±Ø¨Ø©.")

# --------- Ø±Ø³Ø§Ù„Ø© Ø¹Ø¯Ù… Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ© ---------
async def no_permission(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()
    keyboard = [[InlineKeyboardButton("ğŸ”™ Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©", callback_data="back_main")]]
    await query.message.reply_text(
        NO_PERMISSION_TEXT, reply_markup=InlineKeyboardMarkup(keyboard)
    )

# --------- Ø±Ø¬ÙˆØ¹ Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© ---------
async def back_main(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()
    await start(query, context)

# --------- ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ ---------
async def logout(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()
    context.user_data.clear()
    await query.message.reply_text("ğŸšª ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬. Ø§ÙƒØªØ¨ /start Ù„Ù„Ø¨Ø¯Ø¡ Ù…Ù† Ø¬Ø¯ÙŠØ¯.")

# --------- ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨ÙˆØª ---------
def main():
    app = Application.builder().token(TOKEN).build()

    app.add_handler(CommandHandler("start", start))
    app.add_handler(CallbackQueryHandler(ask_username, pattern="insta_username"))
    app.add_handler(CallbackQueryHandler(no_permission, pattern="no_perm"))
    app.add_handler(CallbackQueryHandler(back_main, pattern="back_main"))
    app.add_handler(CallbackQueryHandler(logout, pattern="logout"))
    app.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, receive_username))

    print("Bot is running...")
    app.run_polling()

if __name__ == "__main__":
    main()
